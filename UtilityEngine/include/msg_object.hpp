/**
* @file msg_object.hpp
*
* @author Hourui (liquidmonkey)
*/
#ifndef __MSG_OBJECT_HPP__
#define __MSG_OBJECT_HPP__

#include <atomic>
#include <cstdint>
#include <mutex>

#include "mem_message.hpp"

namespace Utility
{
////////////////////////////////////////////////////////////////////////////////////////////////////
namespace msg
{
////////////////////////////////////////////////////////////////////////////////////////////////////
class dispatcher;
////////////////////////////////////////////////////////////////////////////////////////////////////
class object_iface
{
public:
	object_iface(void) = default;
	virtual ~object_iface(void) = default;

	object_iface(const object_iface&) = delete;
	object_iface& operator=(const object_iface&) = delete;

	virtual void handle_error(void) = 0;
	virtual void do_close(void) = 0;

	virtual void post_message(dispatcher* _dispatcher, bool is_dipatcher);
	virtual mem::message* get_message(object_iface* obj) = 0;
};
////////////////////////////////////////////////////////////////////////////////////////////////////
template<class message_t>
class object : public object_iface
{
public:
	mem::message* get_message(void)
	{
		return &m_message;
	}
private:
	message_t m_message;
};
////////////////////////////////////////////////////////////////////////////////////////////////////
#include "msg_object.inl"
////////////////////////////////////////////////////////////////////////////////////////////////////
}//namespace msg
////////////////////////////////////////////////////////////////////////////////////////////////////
}//namespace Utility 
#endif //__MSG_OBJECT_HPP__